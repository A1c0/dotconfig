#!/usr/bin/env nu
let PLUGIN_DIR = $"($env.CONFIG_DIR)/plugins"

# Bar
sketchybar --bar position=top height=35 blur_radius=0 color=0x00000000

# Defaults
(sketchybar --default padding_left=0
                      padding_right=0
                      icon.font="Hack Nerd Font:Bold:15.0"
                      label.font="SF Pro:Regular:13.0"
                      icon.color=0xffcad3f5
                      label.color=0xffcad3f5
                      icon.padding_left=6
                      icon.padding_right=2
                      label.padding_left=2
                      label.padding_right=6)

# Spaces
sketchybar --add event aerospace_workspace_change
sketchybar --add event aerospace_monitor_change

let space_icon_default = [
   "icon.font=SF Pro:Bold:15.0",
   "label.font=sketchybar-app-font:Regular:16.0",
   background.corner_radius=5,
   background.height=25,
   blur_radius=50,
   padding_left=5,
   padding_right=5,
   icon.padding_left=4,
   icon.padding_right=4,
   label.padding_left=4,
   label.padding_right=4,
]

let sketchybar_options = aerospace list-workspaces --all | lines | each {|workspace|
  let sid = $"space.($workspace)";
  [
    --add, item, $sid, left,
    --set, $sid, drawing=false,
    $"icon=($workspace)",
    $"click_script=aerospace workspace ($workspace)",
    ...$space_icon_default
  ]
} | flatten;

sketchybar ...$sketchybar_options;

let space_subcriber = 'space_subcriber'

(sketchybar --add item $space_subcriber left
            --subscribe $space_subcriber aerospace_workspace_change
            --subscribe $space_subcriber aerospace_monitor_change
            --subscribe $space_subcriber front_app_switched
            --subscribe $space_subcriber space_windows_change
            --set $space_subcriber drawing=false
            $"script=($PLUGIN_DIR)/space.nu")

#Clock
(sketchybar --add item clock right
            --set clock update_freq=10
                        $"script=($PLUGIN_DIR)/clock.nu"
                        icon=
                        label.font="SF Pro Display:Medium:13.0")

# Battery
(sketchybar --add item battery right
            --set battery
                  label.font="SF Pro Display:Medium:13.0"
                  update_freq=10
                  $"script=($PLUGIN_DIR)/battery.nu")

# Right Space
(sketchybar --add bracket sys_panel clock battery
            --set         sys_panel background.color=0x9924273a
                                    background.corner_radius=10
                                    background.height=25
                                    blur_radius=50)

(sketchybar --add item spacer_1 right
            --set spacer_1
                  padding_left=0
                  padding_right=5
                  label.drawing=false)

# Github
(sketchybar --add item github_release right
            --set github_release icon=
                                 icon.font="Hack Nerd Font:Regular:14.0"
                                 icon.color=0xff939ab7
                                 label=1
            --add item github_issue_merge right
            --set github_issue_merge icon=
                                  icon.font="Hack Nerd Font:Regular:14.0"
                                  icon.color=0xffc69ff6
                                  label=1
            --add item github_issue_open right
            --set github_issue_open icon=
                                 icon.font="Hack Nerd Font:Regular:14.0"
                                 icon.color=0xffa6da95
                                 label=1
            --add item github_pr_merge right
            --set github_pr_merge icon=
                                  icon.font="Hack Nerd Font:Regular:14.0"
                                  icon.color=0xffc69ff6
                                  label=1
            --add item github_pr_open right
            --set github_pr_open icon=
                                 icon.font="Hack Nerd Font:Regular:14.0"
                                 icon.color=0xffa6da95
                                 label=1
            --add item github_icon right
            --set github_icon icon=
                              icon.font="Hack Nerd Font:Regular:21.0"
                              label.drawing=false
            --add bracket github_panel /github.*/
            --set         github_panel background.color=0x9924273a
                                       background.corner_radius=10
                                       background.height=25
                                       blur_radius=50)


sketchybar --hotload true
##### Force all scripts to run the first time (never do this in a script) #####
sketchybar --update
