#!/usr/bin/env nu
let PLUGIN_DIR = $"($env.CONFIG_DIR)/plugins"

# Bar
sketchybar --bar position=top height=35 blur_radius=0 color=0x00000000

# Defaults
(sketchybar --default padding_left=5
                      padding_right=5
                      icon.font="Hack Nerd Font:Bold:15.0"
                      label.font="SF Pro:Regular:13.0"
                      icon.color=0xffffffff
                      label.color=0xffffffff
                      icon.padding_left=4
                      icon.padding_right=4
                      label.padding_left=4
                      label.padding_right=4)

# Spaces
sketchybar --add event aerospace_workspace_change
sketchybar --add event aerospace_monitor_change

let space_icon_default = [
   "icon.font=SF Pro:Bold:15.0",
   "label.font=sketchybar-app-font:Regular:16.0",
   background.corner_radius=5,
   background.height=30,
   blur_radius=50,
]

let sketchybar_options = aerospace list-workspaces --all | lines | each {|workspace|
  let sid = $"space.($workspace)";
  [
    --add, item, $sid, left,
    --set, $sid, drawing=false,
    $"icon=($workspace)",
    $"click_script=aerospace workspace ($workspace)",
    ...$space_icon_default
  ]
} | flatten;

sketchybar ...$sketchybar_options;
 
let space_subcriber = 'space_subcriber'

(sketchybar --add item $space_subcriber left
            --subscribe $space_subcriber aerospace_workspace_change
            --subscribe $space_subcriber aerospace_monitor_change
            --subscribe $space_subcriber front_app_switched
            --subscribe $space_subcriber space_windows_change
            --set $space_subcriber drawing=false
            $"script=($PLUGIN_DIR)/space.nu")

# Aldente
sketchybar --add alias "AlDente,Item-0" right

# Clock
(sketchybar --add item clock right 
            --set clock background.color=0x9924273a
                        background.corner_radius=5
                        background.height=30
                        update_freq=10
                        $"script=($PLUGIN_DIR)/clock.nu")

##### Force all scripts to run the first time (never do this in a script) #####
sketchybar --update
